<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>INPUT - {{ program.name }}</title>
    <style>
        body { background-color: #121212; color: #E0E0E0; font-family: sans-serif; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; display: flex; gap: 30px; }
        .panel { background: #1E1E24; padding: 20px; border-radius: 8px; border: 1px solid #333; flex: 1; }
        
        h2 { margin-top: 0; color: {{ program.color }}; border-bottom: 1px solid #444; padding-bottom: 10px; }
        h3 { font-size: 1rem; color: #aaa; margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px;}

        input, select, textarea { width: 100%; padding: 10px; margin-bottom: 15px; background: #2b2b2b; border: 1px solid #444; color: #fff; border-radius: 4px; box-sizing: border-box; }
        
        .btn-add { width: 100%; padding: 12px; background: #444; color: #fff; border: none; cursor: pointer; border-radius: 4px; font-weight: bold; }
        .btn-add:hover { background: #555; }
        
        .btn-publish { width: 100%; padding: 15px; background: {{ program.color }}; color: #000; border: none; cursor: pointer; border-radius: 4px; font-weight: bold; font-size: 1.1rem; margin-top: 20px; }
        .btn-publish:hover { opacity: 0.8; }

        /* ã‚¹ãƒˆãƒƒã‚¯ãƒ»å±¥æ­´ãƒªã‚¹ãƒˆ */
        .list-item { background: #111; padding: 10px; margin-bottom: 8px; border-left: 3px solid #777; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; }
        .stock-new { border-left-color: #00FFCC; background: #1a2a2a; } /* ã‚¹ãƒˆãƒƒã‚¯ã®è‰² */
        .history-item { border-left-color: #555; } /* å±¥æ­´ã®è‰² */

        .btn-icon { text-decoration: none; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; margin-left: 5px; display: inline-block; }
        .btn-edit { background: #444; color: #fff; }
        .btn-del { background: #d8000c; color: #fff; }

        .history-section { max-width: 900px; margin: 40px auto 0; }
        .back-link { display: block; margin-top: 40px; color: #777; text-decoration: none; text-align: center; }
        .alert { background: #224422; color: #88ff88; padding: 10px; margin-bottom: 15px; border-radius: 4px; text-align: center; }
    </style>
</head>
<body>
    <div style="max-width:900px; margin:0 auto 20px;">
        <h1 style="font-size:1.5rem;">{{ program.name }} ç·¨é›†ç”»é¢</h1>
    </div>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
        <div class="alert" style="max-width:900px; margin:0 auto 20px;">{{ messages[0] }}</div>
    {% endif %}
    {% endwith %}

    <div class="container">
        
        <div class="panel">
            <h3>ğŸ–Šï¸ æ–°è¦ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒˆãƒƒã‚¯</h3>
            <form method="POST" action="/admin/add/{{ program_id }}">
                <label>æ”¾é€æ—¥</label>
                <input type="date" name="date" required id="dateInput">
                
                <label>æ™‚é–“</label>
                <input type="text" name="time" placeholder="17:15" required>
                
                <label>ã‚¿ã‚¤ãƒ—</label>
                <select name="type" id="typeSelect" onchange="toggleInputs()">
                    <option value="single">å€‹äºº</option>
                    <option value="group">ã‚°ãƒ«ãƒ¼ãƒ—</option>
                </select>

                <div id="singleInput">
                    <label>ãƒ©ã‚¸ã‚ªãƒãƒ¼ãƒ </label>
                    <input type="text" name="name" placeholder="ä¾‹: å®®å´ã®çŒ«å¥½ã">
                </div>

                <div id="groupInput" style="display:none;">
                    <label>ã‚³ãƒ¼ãƒŠãƒ¼å</label>
                    <input type="text" name="title">
                    <label>ãƒ©ã‚¸ã‚ªãƒãƒ¼ãƒ (ã€Œã€ã€åŒºåˆ‡ã‚Š)</label>
                    <textarea name="group_names" rows="2"></textarea>
                </div>

                <button type="submit" class="btn-add">â†“ ãƒªã‚¹ãƒˆã«è¿½åŠ  (ã¾ã éå…¬é–‹)</button>
            </form>
        </div>

        <div class="panel">
            <h3>ğŸ“¦ ç¾åœ¨ã®ã‚¹ãƒˆãƒƒã‚¯ (æœªå…¬é–‹)</h3>
            
            {% if drafts %}
                <div style="max-height: 400px; overflow-y: auto;">
                    {% for post in drafts %}
                    <div class="list-item stock-new">
                        <div>
                            <span style="color: #00FFCC;">{{ post.date }} {{ post.time }}</span><br>
                            {% if post.type == 'single' %}{{ post.name }}{% else %}{{ post.title }}{% endif %}
                        </div>
                        <div>
                            <a href="/edit/{{ post.id }}" class="btn-icon btn-edit">âœï¸</a>
                            <a href="/delete/{{ post.id }}" class="btn-icon btn-del">ğŸ—‘ï¸</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <form method="POST" action="/admin/publish/{{ program_id }}">
                    <button type="submit" class="btn-publish" onclick="return confirm('ã‚¹ãƒˆãƒƒã‚¯ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã¦å…¬é–‹ã—ã¾ã™ã‹ï¼Ÿ');">
                        ğŸš€ ã‚µã‚¤ãƒˆã«ä¸€æ‹¬å…¬é–‹ã™ã‚‹
                    </button>
                </form>

            {% else %}
                <div style="text-align:center; padding:50px 0; color:#555;">
                    ç¾åœ¨ã‚¹ãƒˆãƒƒã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>å·¦ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
                </div>
            {% endif %}
        </div>
    </div>

    <div class="history-section">
        <h3 style="color:#fff; border-left: 4px solid #777; padding-left: 10px; margin-bottom: 15px;">
            ğŸ“‹ å…¬é–‹æ¸ˆã¿ã®å±¥æ­´ (æœ€æ–°30ä»¶)
        </h3>
        
        {% if history %}
            <div style="background: #1E1E24; padding: 20px; border-radius: 8px; border: 1px solid #333;">
                {% for post in history %}
                <div class="list-item history-item">
                    <div>
                        <span style="color: #aaa;">{{ post.date }}</span> <span style="color: #FF9900;">{{ post.time }}</span><br>
                        {% if post.type == 'single' %}
                            {{ post.name }}
                        {% else %}
                            {{ post.title }} ({{ post.group_names|truncate(20) }})
                        {% endif %}
                    </div>
                    <div>
                        <a href="/edit/{{ post.id }}" class="btn-icon btn-edit">âœï¸</a>
                        <a href="/delete/{{ post.id }}" onclick="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆå…¬é–‹æ¸ˆã¿ã®ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã¾ã™ï¼‰');" class="btn-icon btn-del">ğŸ—‘ï¸</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="color: #777;">ã¾ã å…¬é–‹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        {% endif %}
    </div>
    <a href="/admin" class="back-link">â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹</a>

    <script>
        document.getElementById('dateInput').valueAsDate = new Date();
        function toggleInputs() {
            const type = document.getElementById('typeSelect').value;
            if (type === 'single') {
                document.getElementById('singleInput').style.display = 'block';
                document.getElementById('groupInput').style.display = 'none';
            } else {
                document.getElementById('singleInput').style.display = 'none';
                document.getElementById('groupInput').style.display = 'block';
            }
        }
    </script>
</body>
</html>